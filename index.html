<!doctype html>
<html lang="de">
<head>
  <!-- App / Homescreen Icons -->
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">

<!-- iOS Homescreen -->
<link rel="apple-touch-icon" href="icon-192.png">

<meta name="apple-mobile-web-app-title" content="Karte Sarntal">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#ea9214">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hotel Panoramic Lotsch ‚Äì Karte</title>

  <!-- MapLibre CSS -->
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">

  <style>
    @font-face{
      font-family:'Adam';
      src:url('Adam-Bold.ttf') format('truetype');
      font-weight:700;
      font-style:normal;
    }

    :root{
      --accent: rgb(234,146,20);
      --accent-hover: rgb(214,126,0);
      --ui-scale: 1;
    }

    html,body{height:100%;margin:0;}
    #app{position:relative;height:100vh;}
    #map{position:absolute;inset:0;}

    /* Sidebar */
    #sidebar{
      position:absolute;left:12px;top:12px;z-index:3;
      width:280px;display:flex;flex-direction:column;gap:12px;
      font-family:'Adam',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      font-size:14px;color:#1f2937;
    }
    .panel{
      background:rgba(255,255,255,0.96);
      border-radius:12px;padding:10px 12px;
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
      border:1px solid rgba(0,0,0,0.05);
    }
    .panel h2{font-weight:700;margin:0 0 6px;font-size:15px;}
    .row{display:flex;align-items:center;gap:8px;margin:6px 0;}
    .row input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent);cursor:pointer;}

    /* Toolbar */
    .toolbar{
      position:absolute;left:50%;bottom:16px;transform:translateX(-50%);
      display:flex;gap:12px;
      background:rgba(255,255,255,0.96);
      padding:10px 14px;border-radius:12px;
      border:1px solid rgba(0,0,0,0.05);
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
      z-index:3;
    }
    .btn{padding:8px 14px;border-radius:10px;font-weight:700;cursor:pointer;}
    .btn--primary{background:var(--accent);color:#fff;border:none;}
    .btn--primary:hover{background:var(--accent-hover);}
/* ===== Mobile Rotate Hint ===== */
.rotate-hint{
  position:absolute;
  left:50%;
  bottom:64px;
  transform:translateX(-50%);
  z-index:3;
  background:rgba(255,255,255,0.96);
  border:1px solid rgba(0,0,0,0.05);
  box-shadow:0 4px 14px rgba(0,0,0,0.1);
  border-radius:12px;
  padding:8px 12px;
  font-family:'Adam',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
  font-weight:700;
  font-size:14px;
  color:#1f2937;
  display:none;
  pointer-events:none;
}

/* Nur Handy + Portrait */
@media (max-width: 768px) and (orientation: portrait){
  .rotate-hint{ display:block; }
}

/* Clean Mode / Vollbild: aus */
body.pl-clean .rotate-hint,
#app:fullscreen .rotate-hint{
  display:none !important;
}
    /* Sprachschalter */
    #langSwitcher{
      position:absolute;right:12px;top:12px;z-index:4;
      display:flex;gap:6px;
      background:rgba(255,255,255,0.96);
      border:1px solid rgba(0,0,0,0.05);
      border-radius:10px;padding:6px;
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
    }
    #langSwitcher button{
      min-width:44px;padding:6px 10px;
      border:1px solid #e2e8f0;background:#fff;color:#0f172a;
      border-radius:8px;cursor:pointer;font-weight:700;
    }
    #langSwitcher button[aria-pressed="true"]{
      background:var(--accent);color:#fff;border-color:var(--accent);
    }

    /* Logo */
    #brandLogo{
      position:absolute;left:50%;top:12px;transform:translateX(-50%);
      height:90px;z-index:4;cursor:pointer;
      filter:drop-shadow(0 3px 10px rgba(0,0,0,0.45));
    }
    #app:fullscreen #brandLogo{left:16px;top:16px;transform:none;height:60px;}

    /* Popups & Hover */
    .pl-popup .maplibregl-popup-content{
      background:rgba(255,255,255,0.98);
      border-radius:12px;padding:10px 14px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 10px 24px rgba(0,0,0,0.22);
      font-family:'Adam',system-ui;
    }
    .plp-title{
      font-weight:700;font-size:16px;
      color:rgb(234,146,20);
      margin:0;text-align:center;
    }
    .plp-cta{
      display:inline-block;margin-top:6px;
      font-weight:700;text-decoration:none;
      color:var(--accent);
      border-bottom:2px solid transparent;
      transition:border-color .15s,color .15s;
    }
    .plp-cta:hover{color:var(--accent-hover);border-bottom-color:var(--accent-hover);}

    .pl-hover{
      position:fixed;z-index:1000;pointer-events:none;transform:translate(14px,14px);
      background:rgba(255,255,255,0.98);
      border-radius:12px;padding:10px 14px;
      border:1px solid rgba(0,0,0,0.06);
      box-shadow:0 10px 24px rgba(0,0,0,0.22);
      font-family:'Adam',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      max-width:260px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      display:none;
    }
    #app:fullscreen .plp-title--fullscreen{
      font-weight:700;font-size:16px;color:rgb(234,146,20);margin:0;text-align:center;
    }

    /* Eigener Vollbild-Button */
    #btnFullscreen{
      position:absolute;right:12px;top:70px;z-index:5;
      background:rgba(255,255,255,0.96);
      border:1px solid rgba(0,0,0,0.05);
      border-radius:10px;font-size:20px;padding:6px 10px;
      cursor:pointer;font-weight:700;
      box-shadow:0 4px 14px rgba(0,0,0,0.1);
      transition:background .2s;
    }
    #btnFullscreen:hover{background:var(--accent);color:#fff;}

    /* MapLibre Controls: nur Vollbild */
    .maplibregl-ctrl-top-right .maplibregl-ctrl-group{display:none !important;}
    .maplibregl-ctrl-top-right .maplibregl-ctrl-group.pl-fullscreen-ctrl{display:flex !important;}

    /* Vollbild-Verhalten */
    #app:fullscreen #sidebar,
    #app:fullscreen #brandLogo{display:none !important;}
    #app:fullscreen #toolbar{display:flex !important;z-index:6;}
    #app:fullscreen .pl-hover,
    #app:fullscreen .maplibregl-popup{display:block !important;z-index:6;}
    #app:fullscreen #langSwitcher{display:flex !important;}
    #app:fullscreen .maplibregl-ctrl-top-right .maplibregl-ctrl-group.pl-fullscreen-ctrl{display:flex !important;}
    #app:fullscreen #btnFullscreen{display:block !important;}

    /* Hut marker */
    .hut-marker{
      width:14px;height:14px;border-radius:50%;
      background:#f97316;border:2px solid #fff;
      box-shadow:0 2px 6px rgba(0,0,0,.35);
      cursor:pointer;
    }

    /* ===== Mobile: Panels besser lesbar ===== */
    @media (max-width: 768px){
      #sidebar{width:min(92vw,320px);top:78px;}
      .panel h2{font-size:16px;}
      .row span{font-size:14px;line-height:1.2;}
      .row input[type="checkbox"]{width:22px;height:22px;}
      #brandLogo{height:70px;}
      #langSwitcher{top:8px;right:8px;}
      #btnFullscreen{top:60px;right:8px;}
      .toolbar{bottom:8px;padding:8px 10px;}
      .btn{padding:6px 10px;font-size:13px;}
    }

    /* ===== Mobile Clean Mode (Landscape) ===== */
    body.pl-clean #sidebar{display:none !important;}
    body.pl-clean #langSwitcher{
      transform:scale(var(--ui-scale));
      transform-origin:top right;
    }
    body.pl-clean #toolbar{
      left:50%;bottom:12px;
      transform:translateX(-50%) scale(var(--ui-scale));
      transform-origin:bottom center;
      padding:12px 14px;border-radius:14px;
    }
    body.pl-clean #btnFullscreen{
      top:12px;right:12px;
      transform:scale(var(--ui-scale));
      transform-origin:top right;
    }
    body.pl-clean #brandLogo{
      height:52px;left:12px;top:12px;transform:none;
    }
    body.pl-clean .btn{padding:10px 14px;font-size:15px;}

    @media (max-width: 768px) and (orientation: landscape){
      :root{--ui-scale:1.05;}
    }
    /* ===== Mobile: Fullscreen-Button komplett ausblenden ===== */
@media (max-width: 768px) {
  #btnFullscreen {
    display: none !important;
  }

  .maplibregl-ctrl-fullscreen {
    display: none !important;
  }

  .maplibregl-ctrl-group.pl-fullscreen-ctrl {
    display: none !important;
  }
}
    /* === Logo komplett ausblenden === */
#brandLogo {
  display: none !important;
}
   
    @media (max-width: 768px) {
  #btnFullscreen,
  .maplibregl-ctrl-fullscreen {
    display: none !important;
  }
}
    @media (max-width: 768px) {
  .maplibregl-ctrl-top-right {
    display: none !important;
  }
/* === iOS Mobile: MapLibre Fullscreen Icon entsch√§rfen === */
@media (max-width: 768px) {

  /* gesamte Control-Gruppe verschieben */
  .maplibregl-ctrl-top-right {
    top: auto !important;
    bottom: 6px !important;
    right: 6px !important;
  }

  /* Icon klein & unauff√§llig */
  .maplibregl-ctrl-fullscreen {
    opacity: 0.15 !important;
    transform: scale(0.75) !important;
    pointer-events: none !important;
  }
}
  </style>
</head>

<body>
  <div id="app">
    <div id="map"></div>

    <img id="brandLogo" src="https://i.ibb.co/nq1yywFv/PL-Logo-positiv.png" alt="Hotel Panoramic Lotsch" />

    <div id="langSwitcher" aria-label="Sprache w√§hlen">
      <button data-lang="de" aria-pressed="true">DE</button>
      <button data-lang="en" aria-pressed="false">EN</button>
      <button data-lang="it" aria-pressed="false">IT</button>
    </div>

    <button id="btnFullscreen" aria-label="Vollbild" title="Vollbild">‚õ∂</button>

    <aside id="sidebar" aria-label="Ebenen">
      <section class="panel">
        <h2 data-i18n="summer_title">Sommerwanderungen</h2>
        <label class="row">
          <input id="chkHikeSummer" type="checkbox" checked />
          <span data-i18n="summer_label">Sommerwanderungen anzeigen</span>
        </label>
      </section>

      <section class="panel">
        <h2 data-i18n="winter_title">Winterwanderungen</h2>
        <label class="row">
          <input id="chkHikeWinter" type="checkbox" />
          <span data-i18n="winter_label">Winterwanderungen anzeigen</span>
        </label>
      </section>

      <section class="panel">
        <h2 data-i18n="bike_title">Biken</h2>
        <label class="row">
          <input id="chkBike" type="checkbox" />
          <span data-i18n="bike_label">Biketouren anzeigen</span>
        </label>
      </section>

      <section class="panel">
        <h2 data-i18n="hut_title">H√ºtten</h2>
        <label class="row">
          <input id="chkHuts" type="checkbox" checked />
          <span data-i18n="hut_label">Almh√ºtten anzeigen</span>
        </label>
      </section>
    </aside>

    <div id="toolbar" class="toolbar" role="toolbar" aria-label="Kartensteuerung">
      <button id="btnHotel" class="btn btn--primary" data-i18n="btn_hotel">Zum Hotel</button>
    </div>
  </div>
  
<!-- Mobile Hinweis: Drehen f√ºr Vollbild -->
<div id="rotateHint" class="rotate-hint" data-i18n="rotate_hint">
  Drehen f√ºr Vollbild
</div>
  <!-- Bibliotheken -->
  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
  <script src="https://unpkg.com/@tmcw/togeojson@5.8.0/dist/togeojson.umd.js"></script>
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <script>

    
    /***** === Basis-Settings === *****/
    const IS_MOBILE =
      ("ontouchstart" in window) ||
      (navigator.maxTouchPoints > 0) ||
      window.matchMedia("(max-width: 768px)").matches;

    const MAPTILER_KEY = "XuKPc9StDseDAsK3jypG";
    const HOTEL_COORDS = [11.42021383529052, 46.688025508714325];

    /***** === Daten === *****/
    const HUTS = [
      { id:"bergrestaurantPichlberg", title:"Bergrestaurant Pichlberg", coords:[11.441204,46.695006], link:"https://www.pichlberg.it/" },
      { id:"Pfnatschalm", title:"Pfnatschalm", coords:[11.44159,46.69989], link:"https://www.pfnatschalm.it/de" },
      { id:"Chrust Gepatsch", title:"Chrust Gepatsch", coords:[11.44777,46.68878], link:"https://www.chrust.it/besuche-uns" },
      { id:"Sunnolm", title:"Sunnolm", coords:[11.43378,46.6894], link:"https://www.reinswald.it/de/index-d.php" },
      { id:"Reinswalder M√ºhlen", title:"Reinswalder M√ºhlen", coords:[11.42972,46.68264], link:"https://www.hinterproslhof.it/de" },
      { id:"Getrumalm", title:"Getrumalm", coords:[11.47364,46.69338], link:"https://www.almenrausch.at/einkehr-uebernachtung/detail/getrumalm-2094-m-durnholz/" }
    ];

    const HIKES_SUMMER = [
      { baseId:"oettembacherAlmWindspitze", title:"√ñttembacher Alm & Windspitze", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/ca80bd821b34e68cdf27c7d4ae02d4f3/raw/251f657fc08cf8717dd5c37e1bdc615877fad2c8/gistfile1.txt", color:"#0ea5e9", link:"https://www.komoot.com/de-de/tour/2690794753" },
      { baseId:"pfattnerAlm", title:"Zur Pfattner Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/886aa1fa21b855c1b3e94ba6d890b07a/raw/75b5ad91a65ced29c376274c2f776075df676f2a/gistfile1.txt", color:"#f97316", link:"https://www.komoot.com/de-de/tour/2690780734" },
      { baseId:"traminerAlm", title:"Traminer Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/360b727855bfe02064ae0870d5e6c3f5/raw/abe96d7f65973439f4c00992d28ebd2f4a60cd93/gistfile1.txt", color:"#ea580c", link:"https://www.komoot.com/de-de/tour/2690787869" },
      { baseId:"putzerKreuzJenesingerJoechl", title:"Putzer Kreuz + Jenesinger J√∂chl", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/6468a93747053ef562c0ff9f73e1b6c3/raw/2dd0fe8309a38e2f16d6bcacdf8dd7f816cb8879/gistfile1.txt", color:"#10b981", link:"https://www.komoot.com/de-de/tour/2690890796" },
      { baseId:"leiterspitze", title:"Leiterspitze", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/42a0894dba7d43f8a88548c3df5e5a7f/raw/e1cfbd698c2454c2080afbc6c9aecddd98d3b4e4/gistfile1.txt", color:"#f97316", link:"https://www.komoot.com/de-de/tour/2690896338" },
      { baseId:"durnholzLoopw", title:"Winter Durnholz Loop", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/b6574d2c8df7dae1f46bc8fcdad1bd53/raw/15fa89bc0c19b5eb1574618bc39f16cfbafeebcc/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/de-de/tour/2663206305" },
      { baseId:"talrundwegw", title:"Winter Talrundweg", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/40c03576fccf0b34d25280125bec63fb/raw/d7a0074fda3c14a034740c76962ae7e28ae0b73e/gistfile1.txt", color:"#14b8a6", link:"https://www.komoot.com/tour/2662945355" },
      { baseId:"durnholzerseeKofeljochAlmw", title:"Winter Kofeljoch Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/1faa1453040e7695375afbfa971c6f0c/raw/063170b9ee27f413dc539cda143a333fb99a1685/gistfile1.txt", color:"#22c55e", link:"https://www.komoot.com/tour/2662887299" },
      { baseId:"nachDurnholz", title:"Nach Durnholz", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/b6574d2c8df7dae1f46bc8fcdad1bd53/raw/15fa89bc0c19b5eb1574618bc39f16cfbafeebcc/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/de-de/tour/2663206305" },
      { baseId:"latzfonserKreuz", title:"Latzfonser Kreuz", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/e62978b29b60b46ad31b5b868c4bf489/raw/2bb2de53252a61a2f0fdb6a2ebf27aed55fe433c/gistfile1.txt", color:"#eab308", link:"https://www.komoot.com/de-de/tour/2662400499" },
      { baseId:"getrumAlm", title:"Getrum Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/f44d667d3267b9ab1ee94397a95ec0de/raw/26daebf33212084287225b19697a94a7f23dcab8/gistfile1.txt", color:"#3b82f6", link:"https://www.komoot.com/de-de/tour/2662532511" },
      { baseId:"durnholzerSee", title:"Durnholzer See", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/acfcc6e1f70e0cc8dd0e5e6c434bb634/raw/eabe07106af82b313a7c81298e474d76773ed6b8/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/tour/2662854349" },
      { baseId:"skihuetteStoanerneMandln", title:"Skih√ºtte Stoanerne Mandln", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/bd912558aef6c038e3f76084d54888f5/raw/3aa8e759a9095ab95c1d0bd7e8ad4297796d8cc3/gistfile1.txt", color:"#ef4444", link:"https://www.komoot.com/tour/2662874522" },
      { baseId:"durnholzerseeKofeljochAlm", title:"Kofeljoch Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/1faa1453040e7695375afbfa971c6f0c/raw/063170b9ee27f413dc539cda143a333fb99a1685/gistfile1.txt", color:"#22c55e", link:"https://www.komoot.com/tour/2662887299" }
    ];

    const HIKES_WINTER = [      
     { baseId:"oettembacherAlmWindspitze", title:"√ñttembacher Alm & Windspitze", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/ca80bd821b34e68cdf27c7d4ae02d4f3/raw/251f657fc08cf8717dd5c37e1bdc615877fad2c8/gistfile1.txt", color:"#0ea5e9", link:"https://www.komoot.com/de-de/tour/2690794753" },
      { baseId:"pfattnerAlm", title:"Zur Pfattner Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/886aa1fa21b855c1b3e94ba6d890b07a/raw/75b5ad91a65ced29c376274c2f776075df676f2a/gistfile1.txt", color:"#f97316", link:"https://www.komoot.com/de-de/tour/2690780734" },
      { baseId:"traminerAlm", title:"Traminer Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/360b727855bfe02064ae0870d5e6c3f5/raw/abe96d7f65973439f4c00992d28ebd2f4a60cd93/gistfile1.txt", color:"#ea580c", link:"https://www.komoot.com/de-de/tour/2690787869" },
      { baseId:"putzerKreuzJenesingerJoechl", title:"Putzer Kreuz + Jenesinger J√∂chl", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/6468a93747053ef562c0ff9f73e1b6c3/raw/2dd0fe8309a38e2f16d6bcacdf8dd7f816cb8879/gistfile1.txt", color:"#10b981", link:"https://www.komoot.com/de-de/tour/2690890796" },
      { baseId:"durnholzLoopw", title:"Winter Durnholz Loop", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/b6574d2c8df7dae1f46bc8fcdad1bd53/raw/15fa89bc0c19b5eb1574618bc39f16cfbafeebcc/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/de-de/tour/2663206305" },
      { baseId:"nachDurnholz", title:"Nach Durnholz", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/b6574d2c8df7dae1f46bc8fcdad1bd53/raw/15fa89bc0c19b5eb1574618bc39f16cfbafeebcc/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/de-de/tour/2663206305" },
      { baseId:"talrundweg", title:"Talrundweg", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/40c03576fccf0b34d25280125bec63fb/raw/d7a0074fda3c14a034740c76962ae7e28ae0b73e/gistfile1.txt", color:"#14b8a6", link:"https://www.komoot.com/tour/2662945355" },
      { baseId:"latzfonserKreuz", title:"Latzfonser Kreuz", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/e62978b29b60b46ad31b5b868c4bf489/raw/2bb2de53252a61a2f0fdb6a2ebf27aed55fe433c/gistfile1.txt", color:"#eab308", link:"https://www.komoot.com/de-de/tour/2662400499" },
      { baseId:"getrumAlm", title:"Getrum Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/f44d667d3267b9ab1ee94397a95ec0de/raw/26daebf33212084287225b19697a94a7f23dcab8/gistfile1.txt", color:"#3b82f6", link:"https://www.komoot.com/de-de/tour/2662532511" },
      { baseId:"durnholzerSee", title:"Durnholzer See", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/acfcc6e1f70e0cc8dd0e5e6c434bb634/raw/eabe07106af82b313a7c81298e474d76773ed6b8/gistfile1.txt", color:"#8b5cf6", link:"https://www.komoot.com/tour/2662854349" },
      { baseId:"skihuetteStoanerneMandln", title:"Skih√ºtte Stoanerne Mandln", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/bd912558aef6c038e3f76084d54888f5/raw/3aa8e759a9095ab95c1d0bd7e8ad4297796d8cc3/gistfile1.txt", color:"#ef4444", link:"https://www.komoot.com/tour/2662874522" },
      { baseId:"durnholzerseeKofeljochAlm", title:"Kofeljoch Alm", url:"https://gist.githubusercontent.com/oberhoellerdavid-max/1faa1453040e7695375afbfa971c6f0c/raw/063170b9ee27f413dc539cda143a333fb99a1685/gistfile1.txt", color:"#22c55e", link:"https://www.komoot.com/tour/2662887299" }
    ];

    /***** === Sprachtexte === *****/
 const I18N = {
  de: {
    summer_title: "Sommerwanderungen",
    summer_label: "Sommerwanderungen anzeigen",
    winter_title: "Winterwanderungen",
    winter_label: "Winterwanderungen anzeigen",
    bike_title: "Biken",
    bike_label: "Biketouren anzeigen",
    hut_title: "H√ºtten",
    hut_label: "Almh√ºtten anzeigen",
    btn_hotel: "Zum Hotel",
    cta: "Tour auf Komoot √∂ffnen",
    rotate_hint: "Drehen f√ºr Vollbild"
  },
  en: {
    summer_title: "Summer Hikes",
    summer_label: "Show summer hikes",
    winter_title: "Winter Hikes",
    winter_label: "Show winter hikes",
    bike_title: "Biking",
    bike_label: "Show bike tours",
    hut_title: "Huts",
    hut_label: "Show mountain huts",
    btn_hotel: "To the hotel",
    cta: "Open tour on Komoot",
    rotate_hint: "Rotate for fullscreen"
  },
  it: {
    summer_title: "Escursioni estive",
    summer_label: "Mostra escursioni estive",
    winter_title: "Escursioni invernali",
    winter_label: "Mostra escursioni invernali",
    bike_title: "Bike",
    bike_label: "Mostra tour in bici",
    hut_title: "Malge",
    hut_label: "Mostra malghe",
    btn_hotel: "Vai all‚Äôhotel",
    cta: "Apri il tour su Komoot",
    rotate_hint: "Ruota per schermo intero"
  }
};
    let currentLang = "de";

    /***** === Karte initialisieren === *****/
    const map = new maplibregl.Map({
      container:"map",
      style:`https://api.maptiler.com/maps/hybrid/style.json?key=${MAPTILER_KEY}`,
      center:HOTEL_COORDS,
      zoom:14,
      pitch:60,
      bearing:25,
      antialias:true
    });
if (!IS_MOBILE) {
    map.addControl(new maplibregl.NavigationControl({visualizePitch:true}), "top-right");
    map.addControl(new maplibregl.FullscreenControl({container:document.getElementById("app")}), "top-right");
}
    /***** === Hover-Panel (Desktop) === *****/
    let hoverEl = null;
    function showHover(html){
      if(!hoverEl){
        hoverEl = document.createElement("div");
        hoverEl.className = "pl-hover";
        document.getElementById("app").appendChild(hoverEl);
      }
      hoverEl.innerHTML = html;
      hoverEl.style.display = "block";
    }
    function moveHover(e){
      if(!hoverEl) return;
      const ev = e.originalEvent || e;
      hoverEl.style.left = ev.clientX + "px";
      hoverEl.style.top  = ev.clientY + "px";
    }
    function hideHover(){ if(hoverEl) hoverEl.style.display = "none"; }

    /***** === H√ºtten-Marker === *****/
    let hutMarkers = [];
    function addHuts(){
      if(hutMarkers.length){ hutMarkers.forEach(m=>m.addTo(map)); return; }

      HUTS.forEach(hut=>{
        const el = document.createElement("div");
        el.className = "hut-marker";

        const marker = new maplibregl.Marker({element: el}).setLngLat(hut.coords).addTo(map);

        if(!IS_MOBILE){
          el.addEventListener("mouseenter", (e)=>{
            showHover(`<div class="plp-title plp-title--fullscreen">${hut.title}</div>`);
            moveHover(e);
          });
          el.addEventListener("mousemove", (e)=> moveHover(e));
          el.addEventListener("mouseleave", ()=> hideHover());
        }

        el.addEventListener("click", (e)=>{
          e.stopPropagation();
          const popupHtml = `
            <div class="plp-title">${hut.title}</div>
            <a class="plp-cta" href="${hut.link}" target="_blank" rel="noopener">Website √∂ffnen</a>
          `;
          new maplibregl.Popup({offset:16, className:"pl-popup"})
            .setLngLat(hut.coords)
            .setHTML(popupHtml)
            .addTo(map);
        });

        hutMarkers.push(marker);
      });
    }
    function hideHuts(){ hutMarkers.forEach(m=>m.remove()); }

    /***** === GPX-Layer === *****/
    async function addGpxLayer({url, baseId, color, title, link}){
      const txt = await fetch(url).then(r=>r.text());
      const gpx = new DOMParser().parseFromString(txt, "text/xml");
      const gj  = toGeoJSON.gpx(gpx);

      const srcId  = baseId + "-src";
      const lineId = baseId + "-line";

      if(!map.getSource(srcId)) map.addSource(srcId, {type:"geojson", data: gj});

      if(!map.getLayer(lineId)){
        map.addLayer({
          id: lineId,
          type:"line",
          source: srcId,
          paint:{ "line-color": color, "line-width": 3 },
          layout:{ visibility:"visible" }
        });

        if(!IS_MOBILE){
          map.on("mouseenter", lineId, (e)=>{
            map.getCanvas().style.cursor = "pointer";
            map.setPaintProperty(lineId, "line-width", 5);

            const ctaText = I18N[currentLang].cta;
            const html = document.fullscreenElement
              ? `<div class="plp-title plp-title--fullscreen">${title}</div>`
              : `<div class="plp-title">${title}</div><a class="plp-cta" href="${link}" target="_blank" rel="noopener">${ctaText}</a>`;

            showHover(html);
            moveHover(e);
          });
          map.on("mousemove", lineId, (e)=> moveHover(e));
          map.on("mouseleave", lineId, ()=>{
            map.getCanvas().style.cursor = "";
            map.setPaintProperty(lineId, "line-width", 3);
            hideHover();
          });
        }

        map.on("click", lineId, (e)=>{
          const ctaText = I18N[currentLang].cta;
          const html = `
            <div class="plp-title">${title}</div>
            <a class="plp-cta" href="${link}" target="_blank" rel="noopener">${ctaText}</a>
          `;
          new maplibregl.Popup({offset:16, className:"pl-popup"})
            .setLngLat(e.lngLat)
            .setHTML(html)
            .addTo(map);
        });
      }
    }

    function setVisibility(id, visible){
      if(map.getLayer(id)) map.setLayoutProperty(id, "visibility", visible ? "visible" : "none");
    }

    /***** === Map load === *****/
    map.on("load", async ()=>{
      try{
        map.addSource("terrain-dem",{
          type:"raster-dem",
          url:`https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=${MAPTILER_KEY}`,
          tileSize:512, maxzoom:14
        });
        map.setTerrain({source:"terrain-dem", exaggeration:1.6});
      }catch(_){}
      try{
        map.addLayer({id:"sky", type:"sky", paint:{ "sky-type":"atmosphere", "sky-opacity":1 }});
      }catch(_){}

      // Hotelmarker
      const dot = document.createElement("div");
      dot.style.cssText = "width:16px;height:16px;border-radius:50%;background:#0f766e;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.35)";
      new maplibregl.Marker({element: dot})
        .setLngLat(HOTEL_COORDS)
        .setPopup(new maplibregl.Popup({offset:16, className:"pl-popup"}).setHTML(
          '<strong>Hotel Panoramic Lotsch</strong><br><a class="plp-cta" href="https://www.panoramiclodge.it/de" target="_blank" rel="noopener">Zur Website</a>'
        ))
        .addTo(map);

      const chkSummer = document.getElementById("chkHikeSummer");
      const chkWinter = document.getElementById("chkHikeWinter");
      const chkHuts   = document.getElementById("chkHuts");

      if(chkSummer?.checked) for(const h of HIKES_SUMMER) await addGpxLayer(h);
      if(chkWinter?.checked) for(const h of HIKES_WINTER) await addGpxLayer(h);
      if(chkHuts?.checked) addHuts();

      chkSummer?.addEventListener("change", async ()=>{
        if(chkSummer.checked){
          for(const h of HIKES_SUMMER){
            const id = h.baseId + "-line";
            if(map.getLayer(id)) setVisibility(id, true);
            else await addGpxLayer(h);
          }
        }else{
          for(const h of HIKES_SUMMER) setVisibility(h.baseId + "-line", false);
        }
      });

      chkWinter?.addEventListener("change", async ()=>{
        if(chkWinter.checked){
          for(const h of HIKES_WINTER){
            const id = h.baseId + "-line";
            if(map.getLayer(id)) setVisibility(id, true);
            else await addGpxLayer(h);
          }
        }else{
          for(const h of HIKES_WINTER) setVisibility(h.baseId + "-line", false);
        }
      });

      chkHuts?.addEventListener("change", ()=>{
        if(chkHuts.checked) addHuts();
        else hideHuts();
      });

      // Fullscreen-Control Gruppe markieren (f√ºr CSS)
      const fsBtnCtrl = document.querySelector(".maplibregl-ctrl-fullscreen");
      if(fsBtnCtrl){
        fsBtnCtrl.closest(".maplibregl-ctrl-group")?.classList.add("pl-fullscreen-ctrl");
      }
    });

    /***** === Toolbar ‚ÄûZum Hotel‚Äú === *****/
    document.getElementById("btnHotel")?.addEventListener("click", ()=>{
      map.easeTo({center: HOTEL_COORDS, zoom:14, pitch:60, bearing:25, duration:800});
    });

    /***** === Sprachumschaltung === *****/
    const langButtons = Array.from(document.querySelectorAll("#langSwitcher button"));
    function applyLangTexts(lang){
      currentLang = lang;
      document.querySelectorAll("[data-i18n]").forEach(el=>{
        const key = el.getAttribute("data-i18n");
        if(I18N[lang]?.[key]) el.textContent = I18N[lang][key];
      });
    }
    langButtons.forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const lang = btn.getAttribute("data-lang") || "de";
        langButtons.forEach(b=>b.setAttribute("aria-pressed", String(b===btn)));
        applyLangTexts(lang);
      });
    });
    applyLangTexts(document.documentElement.lang || "de");

    /***** === Logo-Klick === *****/
    document.getElementById("brandLogo")?.addEventListener("click", ()=>{
      window.open("https://www.panoramiclodge.it/de", "_blank", "noopener");
    });

    /***** === Eigener Vollbild-Button === *****/
    const fsBtn = document.getElementById("btnFullscreen");
    if(fsBtn && !IS_MOBILE){
      fsBtn.addEventListener("click", ()=>{
        const app = document.getElementById("app");
        if(!document.fullscreenElement){
          app.requestFullscreen().then(()=>{
            fsBtn.textContent = "üû≠";
            fsBtn.title = "Vollbild beenden";
          }).catch(err=>console.warn(err));
        }else{
          document.exitFullscreen().catch(()=>{});
        }
      });
      document.addEventListener("fullscreenchange", ()=>{
        if(!document.fullscreenElement){
          fsBtn.textContent = "‚õ∂";
          fsBtn.title = "Vollbild";
        }else{
          fsBtn.textContent = "üû≠";
          fsBtn.title = "Vollbild beenden";
        }
      });
    }

    /***** === Mobile: Clean Mode bei Landscape === *****/
    function setCleanMode(on){ document.body.classList.toggle("pl-clean", !!on); }
    function shouldClean(){
      const landscape = window.matchMedia("(orientation: landscape)").matches;
      return IS_MOBILE && landscape;
    }
    function applyLayoutByOrientation(){
      setCleanMode(shouldClean());
      try{ map.resize(); }catch(_){}
    }
    window.addEventListener("orientationchange", applyLayoutByOrientation);
    window.addEventListener("resize", applyLayoutByOrientation);
    applyLayoutByOrientation();
  </script>
</body>
</html>
